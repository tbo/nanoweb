<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">
  <title>nanoweb  - Writing templates</title>
  <link rel="stylesheet" href="/css/main.css">
  <link rel="stylesheet" href="/css/prism-okaidia-a11y.css">
  <link rel="preconnect" href="https://fonts.gstatic.com">
  <link href="https://fonts.googleapis.com/css2?family=Roboto+Slab&family=Source+Code+Pro&family=Source+Serif+Pro:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
  <meta name="description" content="nanoweb is a minimal library for building server-centric multi page web applications that behave like SPAs">
  <meta name="keywords" content="HTML, SPA, JavaScript, Web Components, Template String Literals">
</head>
<body>
  <a href="https://github.com/tbo/nanoweb" class="github-corner" aria-label="View source on GitHub">
    <svg width="80" height="80" viewBox="0 0 250 250" style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg>
  </a>
  <main class="wrapper">
  <nav class="side-nav" id="side-nav">
    <button id="toggleNavButton" onClick="document.getElementById('side-nav').classList.toggle('open')">Menu</button>

    <ul>
      <li class="">
        <a href="/">Introduction</a>
      </li>
      <li class="">
        <a href="/getting-started.html">Getting Started</a>
      </li>
    </ul>
    <div class="title">@nanoweb/template</div>
    <ul>
      
        <li class="active">
          <a href="/template/writing-templates/">Writing templates</a>
        </li>
      
        <li class="">
          <a href="/template/caching-templates/">Caching templates</a>
        </li>
      
        <li class="">
          <a href="/template/render-templates/">Render templates</a>
        </li>
      
        <li class="">
          <a href="/template/use-context/">Use context</a>
        </li>
      
        <li class="">
          <a href="/template/tools/">Tools</a>
        </li>
      
      <li>
        <a href="/api/modules/template_src.html">API</a>
      </li>
    </ul>
    <div class="title">@nanoweb/links</div>
    <ul>
      
        <li class="">
          <a href="/links/recipes/">Recipes</a>
        </li>
      
      <li>
        <a href="/api/modules/links_src_links.html">API</a>
      </li>
    </ul>
  </nav>

  <article>
    <h1>Writing templates</h1>

    <nav class="toc">
                <ol>
                    
                    <li><a href="#render-static-html">Render static HTML</a>
            		</li>

                    <li><a href="#render-dynamic-text-content">Render dynamic text content</a>
            		</li>

                    <li><a href="#using-expressions">Using expressions</a>
            		</li>

                    <li><a href="#nest-and-compose-templates">Nest and compose templates</a>
            
                <ol>
                    
                    <li><a href="#conditional-templates">Conditional templates</a>
            		</li>

                    <li><a href="#repeating-templates">Repeating templates</a>
            		</li>
                </ol>
            		</li>

                    <li><a href="#asynchronous-templates">Asynchronous templates</a>
            		</li>

                    <li><a href="#render-unsafe-strings">Render unsafe strings</a>
            		</li>
                </ol>
            </nav>

    <p><code>@nanoweb/template</code> is a templating library that provides fast, efficient rendering of asynchronous HTML components. It lets you express web UI as a function of data.</p>
<p>This section introduces the main features and concepts in <code>@nanoweb/template</code>.</p>
<h2 id="render-static-html" tabindex="-1">Render static HTML</h2>
<p>The simplest thing to do in <code>@nanoweb/template</code> is to render some static HTML.</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span> html<span class="token punctuation">,</span> renderToString <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@nanoweb/template'</span><span class="token punctuation">;</span><br><br><span class="token comment">// Declare a template</span><br><span class="token keyword">const</span> myTemplate <span class="token operator">=</span> html<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token html language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>Hello World<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span><br><br><span class="token comment">// Render the template</span><br><span class="token function">renderToString</span><span class="token punctuation">(</span>myTemplate<span class="token punctuation">)</span><br>  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">text</span><span class="token punctuation">)</span> <span class="token operator">=></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// => "&lt;div>Hello World&lt;/div>"</span></code></pre>
<p>The template is a <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Template_literals"><em>tagged template literal</em></a>. The template itself looks like a regular JavaScript string, but enclosed in backticks (<code>`</code>) instead of quotes. The string is passed to <code>@nanoweb/template</code>'s <code>html</code> tag function.</p>
<p>The <code>html</code> tag function returns a <code>Template</code>â€”a lightweight object that represents the template to be rendered.</p>
<p>The <code>renderToString</code> function resolves any asynchronous calls and returns a compiled string.</p>
<h2 id="render-dynamic-text-content" tabindex="-1">Render dynamic text content</h2>
<p>You can't get very far with a static template. <code>@nanoweb/template</code> lets you create bindings using <code>${<em>expression</em>}</code> placeholders in the template literal:</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> aTemplate <span class="token operator">=</span> html<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token html language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>title<span class="token interpolation-punctuation punctuation">}</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span></code></pre>
<p>To make your template dynamic, you can create a <em>template function</em>. Call the template function any time your data changes.</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span> html<span class="token punctuation">,</span> renderToString <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@nanoweb/template'</span><span class="token punctuation">;</span><br><br><span class="token comment">// Define a template function</span><br><span class="token keyword">const</span> <span class="token function-variable function">myTemplate</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token operator">=></span> html<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token html language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>Hello <span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span><br><br><span class="token comment">// Render the template with some data</span><br><span class="token function">renderToString</span><span class="token punctuation">(</span><span class="token function">myTemplate</span><span class="token punctuation">(</span><span class="token string">'world'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br>  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">text</span> <span class="token operator">=></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// => "&lt;div>Hello world&lt;/div>"</span><br><br><span class="token comment">// ... Later on ...</span><br><span class="token comment">// Render the template with different data</span><br><span class="token function">renderToString</span><span class="token punctuation">(</span><span class="token function">myTemplate</span><span class="token punctuation">(</span><span class="token string">'there'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br>  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">text</span> <span class="token operator">=></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// => "&lt;div>Hello there&lt;/div>"</span></code></pre>
<p>When you call the template function, <code>@nanoweb/template</code> captures the current expression values. The template function returns a <code>Template</code> that's a function of the input data. This is one of the main principles behind using <code>@nanoweb/template</code>: <strong>creating UI as a <em>function</em> of state</strong>.</p>
<h2 id="using-expressions" tabindex="-1">Using expressions</h2>
<p>The previous example shows interpolating a simple text value, but the binding can include any kind of JavaScript expression:</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> <span class="token function-variable function">myTemplate</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">subtotal<span class="token punctuation">,</span> tax</span><span class="token punctuation">)</span> <span class="token operator">=></span><br>  html<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token html language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>Total: <span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>subtotal <span class="token operator">+</span> tax<span class="token interpolation-punctuation punctuation">}</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span><br><br><span class="token keyword">const</span> <span class="token function-variable function">myTemplate2</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token operator">=></span><br>  html<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token html language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">formatName</span><span class="token punctuation">(</span>name<span class="token punctuation">.</span>given<span class="token punctuation">,</span> name<span class="token punctuation">.</span>family<span class="token punctuation">,</span> name<span class="token punctuation">.</span>title<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span></code></pre>
<p>Expression values can have the following atomic types or any variation of them in lists and promises:</p>
<ul>
<li><code>string</code></li>
<li><code>number</code></li>
<li><code>boolean</code></li>
<li><code>undefined</code></li>
<li><code>null</code></li>
<li><code>Template</code></li>
<li><code>UnsafeHtml</code></li>
</ul>
<h2 id="nest-and-compose-templates" tabindex="-1">Nest and compose templates</h2>
<p>You can also compose templates to create more complex templates. When a binding in the text content of a template returns a <code>Template</code>, the <code>Template</code> is interpolated in place.</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> myHeader <span class="token operator">=</span> html<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token html language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span>Header<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span><br><span class="token keyword">const</span> myPage <span class="token operator">=</span> html<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token html language-html"><br>  <span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>myHeader<span class="token interpolation-punctuation punctuation">}</span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>Here's my main page.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><br></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span></code></pre>
<p>You can use any expression that returns a <code>Template</code>, like another template function:</p>
<pre class="language-js"><code class="language-js"><span class="token comment">// some complex view</span><br><span class="token keyword">const</span> <span class="token function-variable function">myListView</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">items</span><span class="token punctuation">)</span> <span class="token operator">=></span> html<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token html language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">></span></span>...<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">></span></span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span><br><br><span class="token keyword">const</span> <span class="token function-variable function">myPage</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token operator">=></span> html<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token html language-html"><br>  <span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>myHeader<span class="token interpolation-punctuation punctuation">}</span></span><br>  <span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">myListView</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>items<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><br></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span></code></pre>
<p>Composing templates opens a number of possibilities, including conditional and repeating templates.</p>
<h3 id="conditional-templates" tabindex="-1">Conditional templates</h3>
<p><code>@nanoweb/template</code> has no built-in control-flow constructs. Instead you use normal JavaScript expressions and statements.</p>
<h4 id="conditionals-with-ternary-operators" tabindex="-1">Conditionals with ternary operators</h4>
<p>Ternary expressions are a great way to add inline conditionals:</p>
<pre class="language-js"><code class="language-js">html<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token html language-html"><br>  <span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>user<span class="token punctuation">.</span>isLoggedIn<br>    <span class="token operator">?</span> html<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token html language-html">Welcome <span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>user<span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span></span><span class="token template-punctuation string">`</span></span><br>    <span class="token operator">:</span> html<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token html language-html">Please log in</span><span class="token template-punctuation string">`</span></span><br>  <span class="token interpolation-punctuation punctuation">}</span></span><br></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span></code></pre>
<h4 id="conditionals-with-if-statements" tabindex="-1">Conditionals with if statements</h4>
<p>You can express conditional logic with if statements outside of a template to compute values to use inside of the template:</p>
<pre class="language-js"><code class="language-js"><span class="token function">getUserMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">if</span> <span class="token punctuation">(</span>user<span class="token punctuation">.</span>isloggedIn<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">return</span> html<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token html language-html">Welcome <span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>user<span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span><br>    <span class="token keyword">return</span> html<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token html language-html">Please log in</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span><br><br>html<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token html language-html"><br>  <span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">getUserMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><br></span><span class="token template-punctuation string">`</span></span></code></pre>
<h4 id="guard-statements" tabindex="-1">Guard statements</h4>
<p>You can add guard statements to display certain values if certain conditions are met or nothing if not. Falsy values are ignored by <code>html</code>.</p>
<pre class="language-js"><code class="language-js">html<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token html language-html">Welcome <span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>user<span class="token punctuation">.</span>isLoggedIn <span class="token operator">&amp;&amp;</span> user<span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span></span><span class="token template-punctuation string">`</span></span></code></pre>
<h3 id="repeating-templates" tabindex="-1">Repeating templates</h3>
<p>You can use standard JavaScript constructs to create repeating templates.</p>
<h4 id="repeating-templates-with-array.map" tabindex="-1">Repeating templates with Array.map</h4>
<p>To render lists, you can use <code>Array.map</code> to transform a list of data into a list of templates:</p>
<pre class="language-js"><code class="language-js">html<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token html language-html"><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">></span></span><br>    <span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>items<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=></span> html<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token html language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">></span></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>item<span class="token interpolation-punctuation punctuation">}</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">></span></span><br></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span></code></pre>
<p>Note that this expression returns an array of <code>Template</code> objects. <code>nanoweb/template</code> will render an array of subtemplates and other values.</p>
<h4 id="repeating-templates-with-looping-statements" tabindex="-1">Repeating templates with looping statements</h4>
<p>You can also build an array of templates and pass it into a template binding.</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> itemTemplates <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><br><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> i <span class="token keyword">of</span> items<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  itemTemplates<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>html<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token html language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">></span></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>i<span class="token interpolation-punctuation punctuation">}</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br>html<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token html language-html"><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">></span></span><br>    <span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>itemTemplates<span class="token interpolation-punctuation punctuation">}</span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">></span></span><br></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span></code></pre>
<h2 id="asynchronous-templates" tabindex="-1">Asynchronous templates</h2>
<p>Most applications have to reach out to other systems to query for or persist data and therefore often have to handle <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise">Promises</a>. <code>@nanoweb/template</code> makes consuming promises a breeze:</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> <span class="token function-variable function">fetchPost</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">postId</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> response <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/api/posts/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">return</span> response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">const</span> <span class="token function-variable function">getPost</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">postId</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> post <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetchPost</span><span class="token punctuation">(</span>postId<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">return</span> html<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token html language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>post<span class="token punctuation">.</span>title<span class="token interpolation-punctuation punctuation">}</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span>...</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br>html<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token html language-html"><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>header</span><span class="token punctuation">></span></span>My Blog<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>header</span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>main</span><span class="token punctuation">></span></span><br>    <span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">getPost</span><span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>main</span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>footer</span><span class="token punctuation">></span></span>Fancy Footer<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>footer</span><span class="token punctuation">></span></span><br></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span></code></pre>
<p><code>renderToString</code> collects all templates upfront and tries to execute them as deep as possible. This guarantees best<br>
possible execution plan.</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> <span class="token function-variable function">asyncTemplate</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">waitFor</span><span class="token punctuation">)</span> <span class="token operator">=></span><br>  <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token parameter">resolve</span> <span class="token operator">=></span><br>    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">resolve</span><span class="token punctuation">(</span>html<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token html language-html">This took <span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>waitFor<span class="token interpolation-punctuation punctuation">}</span></span>ms</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span> waitFor<span class="token punctuation">)</span><br>  <span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token keyword">const</span> page <span class="token operator">=</span> html<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token html language-html"><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>header</span><span class="token punctuation">></span></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">asyncTemplate</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>header</span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>main</span><span class="token punctuation">></span></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">asyncTemplate</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>main</span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>footer</span><span class="token punctuation">></span></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">asyncTemplate</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>footer</span><span class="token punctuation">></span></span><br></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span><br><br><span class="token comment">// This should take about 200ms to resolve</span><br><span class="token function">renderToString</span><span class="token punctuation">(</span>page<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">text</span> <span class="token operator">=></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<h2 id="render-unsafe-strings" tabindex="-1">Render unsafe strings</h2>
<p><code>html</code> escapes all string expressions by default to thwart <a href="https://owasp.org/www-community/attacks/xss/">XSS attacks</a>. Yet sometimes we want to allow arbitrary html strings to be embedded in our html templates. <code>@nanoweb/template</code> provides <code>unsafeHtml</code> for this. Wrapping any string expression with it will exclude this particular string from being escaped.</p>
<pre class="language-js"><code class="language-js"><br><span class="token comment">// Safe</span><br>html<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token html language-html"><br>  Hello<br>  <span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token string">'mamalicious_user42&lt;script>alert("possible xss attack")&lt;/script>'</span><span class="token interpolation-punctuation punctuation">}</span></span><br></span><span class="token template-punctuation string">`</span></span><br><br><span class="token comment">// Unsafe</span><br>html<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token html language-html"><br>  This is<br>  <span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">unsafeHtml</span><span class="token punctuation">(</span><span class="token string">'&lt;b>UNSAFE&lt;/b>'</span><span class="token interpolation-punctuation punctuation">}</span></span><br>  <span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">unsafeHtml</span><span class="token punctuation">(</span><span class="token string">'&lt;script>alert("possible xss attack")&lt;/script>'</span><span class="token interpolation-punctuation punctuation">}</span></span><br></span><span class="token template-punctuation string">`</span></span></code></pre>

  </article>
</main>


  <footer>
      <div class="wrapper">
        <div class="attribution">
          Code licensed under the
          <a target="_blank" rel="noreferrer" href="https://raw.githubusercontent.com/tbo/nanoweb/master/LICENSE">BSD License</a>.
          Documentation licensed under CC BY 3.0.</br>
          Parts of the documentation are based on works of <a href="https://www.polymer-project.org/">The Polymer Project</a>
        </div>
      </div>
  </footer>
  <script src="https://unpkg.com/@nanoweb/links@0.0.9/dist/links.standalone.min.js"></script>
</body>
</html>
